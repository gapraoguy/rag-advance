# TechMart ChatBot - 高度なRAG実装プロジェクト

## 📋 プロジェクト概要

**目的**: RAGの核心技術（チャンク戦略・クエリ改良・ハイブリッド検索・Re-Ranking）を実践的に学習するためのECサイト向けチャットボット

本プロジェクトは、RAG（Retrieval-Augmented Generation）システムの高度な技術を段階的に実装・検証することを目的としています。TechMartという架空のECサイトを題材に、商品検索とFAQ対応を行うチャットボットを構築しています。

### 学習目標
- 異なるチャンク戦略の効果を定量的に理解
- ベクトル検索とキーワード検索の特性を把握
- Re-Rankingによる検索精度向上の実現
- 実際のECサイトに適用可能な実装パターンの習得

## 🚀 技術スタック

### 開発環境・ツール
- **Python**: 3.11+
- **パッケージ管理**: uv (高速なPythonパッケージマネージャー)
- **アーキテクチャ**: クリーンアーキテクチャ準拠

### AIライブラリ
- **LLM**: GPT-4
- **Embedding**: OpenAI text-embedding-3-large
- **フレームワーク**: LangChain

### データベース・検索
- **Vector DB**: Chroma
- **検索方式**: セマンティック検索、ハイブリッド検索（予定）

### 評価・分析
- **評価ライブラリ**: pandas, numpy, scikit-learn
- **評価指標**: F1スコア、精度、再現率、ヒット率

### 技術選定理由

#### uvの採用理由
- **高速**: pipの10倍高速なパッケージ解決
- **依存関係管理**: lockファイルによる再現可能なビルド
- **モダンな設計**: Rustで実装された次世代ツール

#### Chromaの採用理由
- **軽量**: ローカル開発に適したシンプルなセットアップ
- **LangChain統合**: シームレスな連携
- **永続化**: ファイルベースでの永続化サポート

#### OpenAI Embeddingの採用理由
- **高品質**: 最新のtext-embedding-3-largeモデル
- **多言語対応**: 日本語での高い性能
- **安定性**: プロダクション品質のAPI

## 🏗️ プロジェクト構成（全ての実装が完了後記載）

## 🔄 実装機能（全ての実装が完了後記載）

## 📊 システム性能評価結果

### 📈 Phase 2: チャンク戦略最適化（完了）

**評価対象**: 商品データ（5製品）+ FAQデータ（15件）  
**テストクエリ**: 35件（商品20件 + FAQ15件）  
**最適戦略**: GRANULAR商品戦略 × QA_PAIR FAQ戦略

#### 🎯 最高性能指標
- **F1スコア**: 0.803
- **精度**: 0.743
- **再現率**: 0.943
- **ヒット率**: 0.943
- **総チャンク数**: 97（商品75 + FAQ22）

#### 主要戦略の比較

| 戦略組み合わせ | F1スコア | 精度 | 再現率 | ヒット率 | チャンク数 |
|-------------|----------|------|--------|----------|------------|
| granular+qa_pair | **0.803** | 0.743 | 0.943 | 0.943 | 97 |
| granular+qa_separate | 0.770 | 0.729 | 0.886 | 0.914 | 119 |
| section+qa_pair | 0.717 | 0.676 | 0.886 | **0.943** | 37 |
| section+qa_separate | 0.670 | 0.619 | 0.814 | 0.857 | 59 |
| unified+qa_pair | 0.650 | 0.590 | 0.857 | 0.914 | 27 |
| unified+category_unified | 0.388 | 0.343 | 0.500 | 0.514 | 11 |

#### 📊 データ型別性能
- **商品クエリ** (20件): F1=0.813, ヒット率=90%
- **FAQクエリ** (15件): F1=0.789, ヒット率=100%

#### 🎯 主要成果
- **FAQクエリ**: 100%ヒット率達成
- **総合性能**: F1スコア 0.803で高精度検索を実現
- **実用性**: 97チャンクで効率的な検索システム構築

### 🚧 Phase 3: クエリ改良性能評価（実装予定）

**評価対象**: Phase 2最適戦略 + クエリ改良技術  
**ベースライン**: F1スコア 0.803  
**目標性能**: F1スコア 0.92+（+15%向上）

#### 評価項目（予定）
- **同義語拡張効果**: 「イヤホン」「イヤフォン」「earphone」統一による改善
- **意図理解精度**: 「安いイヤホン」→価格条件抽出の成功率
- **複合条件処理**: 「安くて防水のイヤホン」等の複合検索精度
- **新規評価指標**: クエリ理解精度、条件抽出率、誤変換率

### 🚧 Phase 4: ハイブリッド検索性能評価（実装予定）

**評価対象**: 最適化クエリ + ハイブリッド検索（BM25 + ベクトル検索）  
**ベースライン**: Phase 3完了時性能  
**目標性能**: ベースライン +20%向上

#### 評価項目（予定）
- **検索方式比較**: ベクトル単体 vs BM25単体 vs ハイブリッド
- **クエリタイプ別最適化**: 商品ID検索、感情表現、型番検索での重み調整
- **動的重み調整**: クエリ分類精度とそれに基づく重み決定の効果
- **レスポンス時間**: 検索速度とのトレードオフ分析

### 🚧 Phase 5: Re-Ranking性能評価（実装予定）

**評価対象**: ハイブリッド検索 + Re-Ranking技術  
**ベースライン**: Phase 4完了時性能  
**新規評価指標**: NDCG@3 > 0.85、MRR > 0.9

#### 評価項目（予定）
- **LLMベースRe-Ranking**: Top-K結果の意味的再評価効果
- **ビジネスロジックRe-Ranking**: 在庫・新商品・人気度による順位調整
- **順位品質評価**: NDCG、MRRによる順位の質的評価
- **実用性評価**: レスポンス時間 < 2秒の制約下での性能

## 📈 開発の学習成果

### 技術的な学び
1. **チャンク戦略の重要性**: 適切な粒度設定でF1スコア+30%向上
2. **クリーンアーキテクチャの効果**: 戦略パターンによる柔軟な実装
3. **ベンチマークドリブン開発**: 定量評価による意思決定

### 実装パターンの習得
- **Strategy Pattern**: チャンク戦略の切り替え可能設計
- **Repository Pattern**: データアクセスの抽象化
- **Service Layer**: ビジネスロジックの集約
- **Dependency Injection**: 設定による動的な依存関係解決

### RAG実装のベストプラクティス
- **段階的評価**: 各要素技術の独立した評価
- **メタデータ活用**: 検索結果の品質向上
- **ログ設計**: デバッグとモニタリングの両立

## チャンク化戦略について

本プロジェクトでは、検索精度やベンチマーク評価のために複数の「チャンク化戦略」を実装・比較しています。
各戦略の概要は以下の通りです。

### 商品データ用チャンク戦略

- **unified**  
  商品説明や仕様など、商品に関する全情報を1つのチャンクとして統合します。

- **section**  
  商品データを「仕様」「説明」「注意事項」などのセクションごとに分割し、それぞれを個別のチャンクとして扱います。

- **granular**  
  商品データをさらに細かい単位（例：1文ごと、属性ごと等）で分割し、最小単位の情報をチャンク化します。

### FAQデータ用チャンク戦略

- **qa_pair**  
  FAQの「質問」と「回答」を1つのペアとして1チャンクにまとめます。

- **qa_separate**  
  「質問」と「回答」をそれぞれ独立したチャンクとして分割します。

- **category_unified**  
  同一カテゴリ内のFAQをまとめて1つのチャンクに統合します。